<!DOCTYPE HTML>
<html class="no-js" lang="zh-CN">
<!--
//                            _ooOoo_
//                           o8888888o
//                           88" . "88
//                           (| -_- |)
//                            O\ = /O
//                        ____/`---'\____
//                      .   ' \\| |// `.
//                       / \\||| : |||// \
//                     / _||||| -:- |||||- \
//                       | | \\\ - /// | |
//                     | \_| ''\---/'' | |
//                      \ .-\__ `-` ___/-. /
//                   ___`. .' /--.--\ `. . __
//                ."" '< `.___\_<|>_/___.' >'"".
//               | | : `- \`.;`\ _ /`;.`/ - ` : | |
//                 \ \ `-. \_ __\ /__ _/ .-` / /
//         ======`-.____`-.___\_____/___.-`____.-'======
//                            `=---='
//                 拦截插件累计拦截逗比攻击"1381438"次！
//         .............................................
//                  佛祖保佑             永无BUG
//          佛曰:
//                  写字楼里写字间，写字间里程序员；
//                  程序人员写程序，又拿程序换酒钱。
//                  酒醒只在网上坐，酒醉还来网下眠；
//                  酒醉酒醒日复日，网上网下年复年。
//                  但愿老死电脑间，不愿鞠躬老板前；
//                  奔驰宝马贵者趣，公交自行程序员。
//                  别人笑我忒疯癫，我笑自己命太贱；
//                  不见满街漂亮妹，哪个归得程序员？
-->
<head>
    <!--[if lte IE 9]>
<meta http-equiv="refresh" content="0;url=http://yoursite.com/warn.html">
<![endif]-->
<meta charset="utf-8">

<meta http-equiv="X-UA-Compatible" content="IE=Edge">
<meta name="renderer" content="webkit">
<meta name="viewport" content="width=device-width, initial-scale=1.0,user-scalable=no">
<meta http-equiv="mobile-agent" content="format=html5; url=http://yoursite.com">
<meta name="author" content="John Doe">
<link rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="/css/SimpleStyle.min.css">

<link rel="shortcut icon" href="/images/favicon.png">


<title>网络编程 - Leiwenxuan</title>

<meta name="keywords" content="">

<meta name="description " content="">
</head>
<body>
<div id="nav">
    <nav class="nav-menu">
        <a class="site-name current" href="/" title="雷">雷</a>
        <a class="site-index current" href="/"><i class="fa fa-home"></i><span>Home</span></a>
        <a href="/archives" title="Archives"><i class="fa fa-archives"></i><span>Archives</span></a>
        <a href="/tags" title="Tags"><i class="fa fa-tags"></i><span>Tags</span></a>
        <!-- custom single page of menus -->
        
        
        <a href="/help" title="帮助">
            <i class="fa fa-question-circle"></i>
            <span>帮助</span>
        </a>
        
    </nav>
</div>

<div class="nav-user">
    <a class="btn-search" href="#"><i class="fa fa-search"></i></a>
    <a class="btn-read-mode" href="#"><i class="fa fa-sun-o"></i></a>
    <a class="btn-sns-qr" href="javascript:"><i class="fa fa-telegram"></i></a>
</div>

<div id="wrapper" class="clearfix">
    <div id="body">
        <div class="main" id="main">
            <div id="cover">
    <div class="cover-img"></div>
    <div class="cover-info">
        
        <h1 class="cover-siteName">雷文轩</h1>
        <h3 class="cover-siteTitle">不断学习， 突破自我</h3>
        <p class="cover-siteDesc">一个关注自身成长，时刻保持敬畏心</p>
        <div class="cover-sns">
            
            <div class="btn btn-telegram">
                <a href="http://t.me/kunyintang" target="_blank" title="telegram" ref="friend">
                    <i class="fa fa-telegram"></i>
                </a>
            </div>
            
            <div class="btn btn-instagram">
                <a href="https://www.instagram.com/mtangsir/" target="_blank" title="instagram" ref="friend">
                    <i class="fa fa-instagram"></i>
                </a>
            </div>
            
            <div class="btn btn-twitter">
                <a href="https://twitter.com/tangkunyin" target="_blank" title="twitter" ref="friend">
                    <i class="fa fa-twitter"></i>
                </a>
            </div>
            
            <div class="btn btn-github">
                <a href="https://github.com/tangkunyin" target="_blank" title="github" ref="friend">
                    <i class="fa fa-github"></i>
                </a>
            </div>
            
        </div>
    </div>
</div>
            <div class="page-title">
    <ul>
        <li><a href="/">最新</a></li>
        
        
        
        <li class="page-search">
    <form id="search" class="search-form">
        <label for="s" class="sr-only">Input Search key Words Here</label>
        <input class="search-field" type="text" name="s" class="text" placeholder="Input Search key Words Here" />
        <button type="submit" class="search-form-submit" title="Search"><i class="fa fa-search"></i></button>
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="Type something..."/>
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: 'Posts',
            PAGES: 'Pages',
            CATEGORIES: 'Categories',
            TAGS: 'Tags',
            UNTITLED: '(Untitled)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
</li>

    </ul>
</div>
<div class="main-inner">
    <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
        <div class="post-header">
            <div class="post-author clearfix">
                <a class="avatar fleft" href="" target="_blank">
                    <img width="48" src="" alt="avatar"/>
                </a>
                <p><span class="label">作者</span>
                    <a href="" target="_blank"></a>
                    <span title="最后编辑于2018-10-02">2018-10-02</span>
                </p>
                <p></p>
            </div>
            <h2 class="post-title">网络编程</h2>
            <div class="post-meta">
                本文总共5443个字 | 您是第<span id="busuanzi_value_page_pv"><i class="fa fa-spinner fa-spin"></i></span>位看到它们的小伙伴
            </div>
        </div>
        <div class="post-content markdown-body">
            <p>##1：软件开发的架构</p>
<p>###两件程序之间通讯的应用大致可以分为两种：<br>    第一种：qq. 微信，网盘，优酷 这一类是属于需要安装的桌面应用<br>    第二种：比如百度， 知乎，博客园之类</p>
<p>####c/s架构<br>    即Client 与 Server， 客户端与服务器的端架构</p>
<p>####b/s架构<br>    Browser 与 Serverm 浏览器与服务端架构</p>
<p>##IP地址</p>
<pre><code>1: 网卡 ：身份证 mac地址 计算机在网络上的身份证
2: 交换机 ：负责一个网络内的多台机器之间的信息交换
3: mac地址 ：16进制的数  全球唯一

1: 127.0.0.1 ：本地回环地址 本机的地址
2: 0.0.0.0 ： ip地址的、回环地址的所有的用户都能找到你这台机器
</code></pre><p>####局域网</p>
<pre><code># 局域网
1: 网关ip    不同局域网之间通信依赖的ip地址
2: 子网掩码  判断两个ip地址是否在同一个网段内
3：网段


# 0.0.0.0 - 255.255.255.255
# 局域网的概念
# 外网ip 我们谁都能访问
# 内网ip 从外部不能访问，只能在内部环境中互相访问
# 外网ip永远不会和内网ip冲突？
# 0.0.0.0 - 255.255.255.255中间为内网保留了一些字段
# 192.168.0.0 - 192.168.255.255
# 10.0.0.0 - 10.255.255.255
# 172.16.0.0 - 172.31.255.255
</code></pre><p>###局域网中两台机器的通信原理</p>
<h1 id="局域网中两台机器的通信原理"><a href="#局域网中两台机器的通信原理" class="headerlink" title="局域网中两台机器的通信原理"></a>局域网中两台机器的通信原理</h1><pre><code># 交换机
# ip地址
# ip地址 -arp协议-&gt; mac地址
# mac地址 ： 全球唯一
# arp协议 ： 广播 和 单播
    # 通过ip地址获取mac地址
    # 一台机器A发起一个arp请求（只包含ip地址），发送给交换机
    # 交换机接收到请求，广播这条消息
    # 所有的机器都会接收到这个请求，只有和要寻找ip地址吻合的机器B
    # 才会回应交换机的广播，（带着自己的mac地址）
    # 交换机通过单播的形式将回复的B的mac地址发送给A
# 判断两台机器是不是在同一个局域网内：
    # 子网掩码
    # A机器的ip地址和A的子网掩码 按位与
    # B机器的ip地址和B的子网掩码 按位与
    # 得到的结果如果一致 那么说明两台机器是在一个网段内的
</code></pre><p>####端口</p>
<pre><code># 端口的概念 —— 帮助你找到一个应用
# 每一个网络服务都会占用计算机上的一个端口
# 计算机上的端口范围 0-65535
# 在同一时刻 同一台计算机上 不同的网络应用 占用的端口一定是不同的
</code></pre><p>##2：OSI 七层模型</p>
<p>####在7层的基础上简化为5层</p>
<pre><code># 应用层 http、https ftp smtp
# 传输层 TCP、UDP协议  4层路由器， 4层交换机
        # 端口 ：找到某一台机器上的具体的网络应用
        # tcp 面向连接 可靠 慢 全双工
            # 三次握手 建立tcp连接的过程
            # 发消息
            # 四次挥手 断开tcp连接的过程
           # udp 无连接 不可靠 快

# 网络层 ip协议  3层交换机 3层路由器
# 数据链路层 arp协议 / mac地址 网卡，交换机
        arp协议：根据ip地址找mac地址 ----交换机（广播， 单播）
# 物理层
</code></pre><p>##Tcp 和 Udp</p>
<h4 id="tcp-面向连接的-可靠的-但是慢"><a href="#tcp-面向连接的-可靠的-但是慢" class="headerlink" title="tcp 面向连接的 可靠的 但是慢"></a>tcp 面向连接的 可靠的 但是慢</h4><pre><code># tcp协议
# 两个应用之间要想通信 必须先建立连接
# 然后基于连接来通信
# 比较重要的文件 邮件的发送 下载安装包
#比较可靠的长数据
</code></pre><h4 id="udp-无连接的-快-能够发送的信息长度是有限的"><a href="#udp-无连接的-快-能够发送的信息长度是有限的" class="headerlink" title="udp 无连接的 快 能够发送的信息长度是有限的"></a>udp 无连接的 快 能够发送的信息长度是有限的</h4><pre><code># 快 但 不可靠 不能发送过长的数据
# 即时通讯类的程序
#高并发的短消息
</code></pre><p>###tcp和udp 的区别<br>     tcp、udp是通过网络通信的两种方式<br>       tcp 先建立连接再通信</p>
<pre><code>    # 可靠
    # 慢， 流式传输
udp 不需要建立连接直接通信
    # 快
    # 不可靠
</code></pre><p>###<strong>TCP协议中的数据传递</strong></p>
<p>###tcp协议的拆包机制</p>
<pre><code>当发送端缓冲区的长度大于网卡的MTU时，tcp会将这次发送的数据拆成几个数据包发送出去。 
MTU是Maximum Transmission Unit的缩写。意思是网络上传送的最大数据包。MTU的单位是字节。 
大部分网络设备的MTU都是1500。如果本机的MTU比网关的MTU大，大的数据包就会被拆开来传送，这样会产生很多数据包碎片，增加丢包率，降低网络速度。
</code></pre><p>###面向流的通信特点和Nagle算法</p>
<pre><code>TCP（transport control protocol，传输控制协议）是面向连接的，面向流的，提供高可靠性服务。
收发两端（客户端和服务器端）都要有一一成对的socket，因此，发送端为了将多个发往接收端的包，
更有效的发到对方，使用了优化方法（Nagle算法），将多次间隔较小且数据量小的数据，合并成一个大的数据块，然后进行封包。
这样，接收端，就难于分辨出来了，必须提供科学的拆包机制。 即面向流的通信是无消息保护边界的。 
对于空消息：tcp是基于数据流的，于是收发的消息不能为空，这就需要在客户端和服务端都添加空消息的处理机制，
防止程序卡住，而udp是基于数据报的，即便是你输入的是空内容（直接回车），也可以被发送，udp协议会帮你封装上消息头发送过去。 
可靠黏包的tcp协议：tcp的协议数据不会丢，没有收完包，下次接收，会继续上次继续接收，己端总是在收到ack时才会清除缓冲区内容。数据是可靠的，但是会粘包。
</code></pre><p>###一个简单的tcp： server 和 client</p>
<p>####sever<br>    from socket import *<br>    ip_port = (‘127.0.0.1’, 9514)</p>
<pre><code>sk = socket(AF_INET, SOCK_STREAM)
sk.bind(ip_port)
sk.listen()
sk_cl, addr = sk.accept()
data1 = sk_cl.recv(10)
data2 = sk_cl.recv(10)

print(&apos;-----&gt;&apos;, data1.decode(&apos;utf-8&apos;))
print(&apos;-----&gt;&apos;, data2.decode(&apos;utf-8&apos;))

sk_cl.close()
</code></pre><p>####client<br>    from socket import *<br>    ip_port = (‘127.0.0.1’, 9514)</p>
<pre><code>sk = socket(AF_INET, SOCK_STREAM)
sk.connect(ip_port)

sk.send(b&apos;my name is leiwenxuan&apos;)
sk.send(b&apos;nsdfasfdsf&apos;)
</code></pre><p>####udp的简单程序</p>
<p>###sever<br>    import socket<br>    sk = socket.socket(type=socket.SOCK_DGRAM)</p>
<pre><code>sk.bind((&apos;127.0.0.1&apos;, 9000))
while 1:
    msg,addr = sk.recvfrom(1024)
    print(msg.decode(&apos;utf-8&apos;), addr)
    # sk.sendto(&apos;正在发送...&apos;.encode(&apos;utf-8&apos;), addr)
    inp = input(&apos;input :&apos;)
</code></pre><p>###client<br>    import socket</p>
<pre><code>sk = socket.socket(type=socket.SOCK_DGRAM)
sk.bind((&apos;127.0.0.1&apos;, 9001))

while 1:
    # sk.sendto(&apos;正在发送...&apos;.encode(&apos;utf-8&apos;), (&apos;127.0.0.1&apos;, 9000))
    inp = input(&apos;input:&apos;)
    sk.sendto(inp.encode(&apos;utf-8&apos;),(&apos;127.0.0.1&apos;, 9000) )
    msg, addr = sk.recvfrom(1024)
    print(msg.decode(&apos;utf-8&apos;), addr[1])
</code></pre><p>##一个重要的黏包处理</p>
<p>###server<br>    import json, struct<br>    ‘’’传输一个简单的文件’’’<br>    import os<br>    from socket import *<br>    path_name = r’G:\python笔记\Pythonjing\day31\video\1.内容回顾和作业讲解.mp4’<br>    path_name = os.path.realpath(path_name)<br>    size = str(os.path.getsize(path_name))</p>
<pre><code>ip_port = (&apos;127.0.0.1&apos;, 9514)
sk = socket(AF_INET, SOCK_STREAM)
sk.bind(ip_port)
sk.listen()
sk_cl, addr = sk.accept()

sk_cl.send(size.encode(&apos;utf-8&apos;))
with open(path_name, &apos;rb&apos;) as f:
    while 1:
        data = f.read(2048)
        pack_num = struct.pack(&apos;i&apos;, len(data))
        sk_cl.send(pack_num)
        sk_cl.send(data)
        if not data:
            pack_num = struct.pack(&apos;i&apos;, len(&apos;&apos;))
            sk_cl.send(pack_num)
            print(len(data))
            break
</code></pre><p>##client<br>    from socket import *<br>    import struct<br>    import sys</p>
<pre><code>def processBar(num, total):
    &apos;&apos;&apos;进度条&apos;&apos;&apos;
    rate = num / total
    rate_num = int(rate * 100)
    if rate_num == 100:
        r = &apos;\r%s&gt;%d%%\n&apos; % (&apos;|&apos; * rate_num, rate_num,)
    else:
        r = &apos;\r%s&gt;%d%%&apos; % (&apos;|&apos; * rate_num, rate_num,)
    sys.stdout.write(r)
    sys.stdout.flush


ip_port = (&apos;127.0.0.1&apos;, 9514)
sk = socket(AF_INET, SOCK_STREAM)
sk.connect(ip_port)


size = int(sk.recv(1024).decode(&apos;utf-8&apos;))
# processBar(2048, size)
num_size = 0
with open(&apos;lw.mp4&apos;,&apos;wb&apos;) as f:
    while 1:
        pack_num = sk.recv(4)
        num = struct.unpack(&apos;i&apos;, pack_num)[0]
        # print(num)
        if not num:
            break
        ret = sk.recv(num)
        f.write(ret)
        num_size += num
        processBar(num_size, size)
</code></pre>
        </div>
        <div class="post-tool">
            <a class="btn-thumbs-up" href="javascript:void(0);" data-cid="52" title="95">
                <i class="fa fa-thumbs-up" aria-hidden="true"></i> 打赏
            </a>
        </div>
        
        <div class="post-tags">Tags：
            
        </div>
        
    </article>
    
    <p>本文代表个人观点，内容仅供参考。若有不恰当之处，望不吝赐教！</p>
    
    
</div>
<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
        </div><!-- end #main-->
    </div><!-- end #body -->
    <footer class="footer">
    <div class="footer-inner">
        <p>
            <a href="/about"  title="About">About</a>&nbsp;&nbsp<em>·</em>&nbsp;&nbsp
            <!-- 自定义链接 -->
            <a href="/help" title="help" >急救中心</a>&nbsp;&nbsp<em>·</em>&nbsp;&nbsp
            <a href="/links" title="友情链接">友情链接</a>&nbsp;&nbsp<em>·</em>&nbsp;&nbsp
            <a href="/app" title="App下载">App下载</a>
        </p>
        <p>
            本站点采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议</a>，已建立<a href="/timeline" id="siteBuildingTime"></a>天<br/>
            ©2017 基于<a href="http://hexo.io" target="_blank">Hexo</a>搭建
            ，主题&nbsp<a href="https://github.com/tangkunyin/hexo-theme-jsimple" target="_blank">JSimple</a>
            ，作者<a href="https://www.tangkunyin.com" target="_blank">唐先森</a>
            ，Hosted by <a href="https://pages.coding.me" style="font-weight: bold">Coding Pages</a>
        </p>
        

    </div>
</footer>
<script src="//cdn.bootcss.com/jquery/3.1.1/jquery.min.js"></script>
<script src="/js/InsightSearch.js"></script>
<script src="/js/SimpleCore.js"></script>

</div>
<div class="fixed-btn">
    <a class="btn-gotop" href="javascript:"> <i class="fa fa-angle-up"></i></a>
</div>
<script>
    $(function () {
        SimpleCore.init({
            buildingTime: '01/20/2018',
            current: $('.post-tags').length > 0 ? 'post' : 'archive',
            snsQRCode: '/images/sns-qrcode.png',
            donateImg: '/images/donate-qr.png',
        });
    });
</script>
</body>
</html>
